import ubinascii, uos, machine,uhashlib
from ubinascii import hexlify
b64="""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
"""

def calc_hash(b):
    return hexlify(uhashlib.sha256(uartremote).digest()).decode()

# this is the hash of the compiled uartremote.mpy
hash_gen='d5e0db6f446d97b1966a69fc41c108c99fcfce08b79469a988a9942313b39dd2'

uartremote=ubinascii.a2b_base64(b64)
hash_initial=calc_hash(uartremote)

try: # remove any old versions of uartremote library
    uos.remove('/projects/uartremote.py')
    uos.remove('/projects/uartremote.mpy')
except OSError:
    pass

print('writing uartremote.mpy to folder /projects')
with open('/projects/uartremote.mpy','wb') as f:
    f.write(uartremote)
print('Finished writing uartremote.mpy.')
print('Checking hash.')
uartremote_check=open('/projects/uartremote.mpy','rb').read()
hash_check=calc_hash(uartremote_check)

print('Hash generated: ',hash_gen)
error=False
if hash_initial != hash_gen:
    print('Failed hash of base64 input : '+hash_initial)
    error=True
if hash_check != hash_gen:
    print('Failed hash of .mpy on SPIKE: '+hash_check)
    error=True

if not error:
    print('Uartremote library written succesfully. Resetting....')
    machine.reset()
else:
    print('Failure in Uartremote library!')

